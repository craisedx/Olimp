<script src="https://kendo.cdn.telerik.com/2022.1.119/js/jszip.min.js"></script>
<div class="container">
    <div class="content">
        <div class="mt-3 mb-4 d-flex justify-content-center mt-3">
                    <button type="submit" class="btn btn-primare" onclick="exportChart()">Сохранить диаграмму</button>
                </div>
        <div class="row mt-3 d-flex justify-content-center">
            <p>
                Дата начала:
                <input id="startDate" class="mb-3" style="margin:15px;"/>
                Дата окончания:
                <input id="endDate" class="mb-3" style="margin:15px;"/>
            </p>
        </div>
        <div id="chart"></div>
    </div>
</div>

<script>
    function exportChart(){
        var chart = $("#chart").getKendoChart();
            chart.exportImage().done(function(data) {
                kendo.saveAs({
                    dataURI: data,
                    fileName: "Отчёт по проданным товарам по категориям.png"
                });
            });
    }
    $(document).ready(function () {
        onFilterChange();
    });
    $("#startDate").kendoDatePicker({
        value: new Date('@DateTime.Now.AddMonths(-1).ToString("yyyy-MM-dd HH:mm:ss")'),
        change: onFilterChange,
        format: "{0:dd/MM/yyyy}"
    });
    
    function onFilterChange() {
          var a = $("#chart").data("kendoChart").dataSource.read();
        }
        
    $("#endDate").kendoDatePicker({
        value: new Date('@DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")'),
        change: onFilterChange,
        format: "{0:dd/MM/yyyy}"
        });
</script>

<script>
 $("#chart").kendoChart({
     dataSource: {
         transport: {
             read: {
                 url: "@Url.Action("GetSellsByCategory", "Admin")",
                 data: function() {
                     var dateStart = $("#startDate").data("kendoDatePicker").value();
                     var dateEnd = $("#endDate").data("kendoDatePicker").value();
                     var dateStartConverted = kendo.toString(dateStart, "dd/MM/yyyy");
                     var dateEndConverted = kendo.toString(dateEnd, "dd/MM/yyyy");
                     return {
                         dateStart: kendo.toString(dateStartConverted, "dd/MM/yyyy"),
                         dateEnd: kendo.toString(dateEndConverted, "dd/MM/yyyy")
                     };
                 }
             },
         },
         sort: {
             field: "order",
             dir: "asc"
         }
     },
     title: {
         position: "top",
         text: "Отчёт по проданным товарам по категориям"
     },
     seriesDefaults: {
         type: "pie",
         labels: {
             template: "#= dataItem.category # - #= kendo.format('{0:P}', percentage)#",
             position: "outsideEnd",
             visible: true,
             background: "transparent"
         },
     },
     series: [{
         field: "count",
         categoryField: "category",
         visibleInLegend: "true"
     }],
     tooltip: {
         visible: true,
         format: "N0",
         template: "#= dataItem.category # - #= kendo.format('{0:P}', percentage)#"
     }
 });
</script>